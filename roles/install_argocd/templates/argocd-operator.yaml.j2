--- 
apiVersion: v1 
kind: Namespace 
metadata: 
  name: openshift-gitops-operator
---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-gitops
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  namespace: openshift-gitops-operator
  name: openshift-gitops-operator
spec:
  upgradeStrategy: Default
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  namespace: openshift-gitops-operator
  name: openshift-gitops-operator
spec: 
  name: openshift-gitops-operator
  sourceNamespace: openshift-marketplace
  source: redhat-operators
  channel: latest
  installPlanApproval: Automatic
  config:
    env:
    - name: ARGOCD_CLUSTER_CONFIG_NAMESPACES
      value: openshift-gitops
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: cluster-argocd-system-role
  labels:
    app.kubernetes.io/instance: systemconfig
rules:
- verbs: ['*']
  apiGroups: ['apps']
  resources:
  - deployments
  - daemonsets
- verbs: ['*']
  apiGroups: ['']
  resources:
  - limitranges
  - secrets
  - services
  - serviceaccounts
  - resourcequotas
- verbs: ['*']
  apiGroups: ['logging.openshift.io']
  resources:
  - clusterlogforwarders
  - clusterloggings
- verbs: ['*']
  apiGroups: ['monitoring.coreos.com']
  resources:
  - prometheusrules
- verbs: ['*']
  apiGroups: ['admissionregistration.k8s.io']
  resources:
  - mutatingwebhookconfigurations
- verbs: ['*']
  apiGroups: ['apiextensions.k8s.io']
  resources:
  - customresourcedefinitions
- verbs: ['*']
  apiGroups: ['networking.k8s.io']
  resources:
  - ingresses
  - networkpolicies
- verbs: ['*']
  apiGroups: ['security.openshift.io']
  resources:
  - securitycontextconstraints
- verbs: ['*']
  apiGroups: ['project.openshift.io']
  resources:
  - projects
- verbs: ['*']
  apiGroups: ['route.openshift.io']
  resources:
  - routes
- verbs: ['*']
  apiGroups: ['argoproj.io']
  resources:
  - argocd
- verbs: ['*']
  apiGroups: ['snapshot.storage.k8s.io']
  resources: ['*']
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: cluster-argocd-system-role-binding
  labels:
    app.kubernetes.io/instance: systemconfig
subjects:
- kind: ServiceAccount
  namespace: openshift-gitops
  name: openshift-gitops-argocd-application-controller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-argocd-system-role
